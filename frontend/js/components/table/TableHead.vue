<template>
  <tr class="tablehead">
    <td class="tablehead__cell f--small" v-for="col in columns" @click="sortColumn(col)" :key="col.name" :class="cellClasses(col)">
      <span v-if="isSortableColumn(col)">{{ col.label }} <span class="tablehead__arrow"><span v-svg symbol="arrow-sort"></span></span></span>
      <a v-if="col.name === 'bulk'" href="#" @click.prevent.stop="toggleBulkSelect()"><span><a17-checkbox name="bulkAll" :value="1" :initialValue="bulkValue" :class="{ 'checkbox--minus' : checkboxMinus }" ></a17-checkbox></span></a>
    </td>
    <td class="tablehead__spacer">&nbsp;</td>
  </tr>
</template>

<script>
  import { mapState, mapGetters } from 'vuex'

  export default {
    name: 'A17Tablehead',
    props: {
      columns: {
        type: Array,
        default: function () { return [] }
      }
    },
    data: function () {
      return {
        currentSort: 'name',
        currentDirection: 'asc' // asc or desc
      }
    },
    computed: {
      bulkValue: function () {
        return this.bulkIds.length ? 1 : 0
      },
      checkboxMinus: function () {
        return this.bulkIds.length > 0 && this.bulkIds.length !== this.dataIds.length
      },
      ...mapState({
        bulkIds: state => state.datatable.bulk,
        sortKey: state => state.datatable.sortKey,
        sortDir: state => state.datatable.sortDir
      }),
      ...mapGetters([
        'dataIds'
      ])
    },
    methods: {
      cellClasses: function (col) {
        return [
          col.name === 'draggable' ? 'tablehead__cell--draggable' : '',
          col.name === 'bulk' ? 'tablehead__cell--bulk' : '',
          col.sortable ? 'tablehead__cell--sortable' : '',
          col.name === this.sortKey ? `tablehead__cell--sorted` : '',
          col.name === this.sortKey && this.sortDir ? `tablehead__cell--sorted${this.sortDir}` : ''
        ]
      },
      isSortableColumn: function (col) {
        return col.name !== 'draggable' &&
               col.name !== 'featured' &&
               col.name !== 'bulk' &&
               col.name !== 'published' &&
               col.name !== 'thumbnail'
      },
      sortColumn: function (column) {
        this.$emit('sortColumn', column)
      },
      toggleBulkSelect: function () {
        const newBulkIds = (this.bulkIds.length) ? [] : this.dataIds
        this.$store.commit('replaceDatableBulk', newBulkIds)
      }
    }
  }
</script>

<style lang="scss" scoped>
  @import '~styles/setup/_mixins-colors-vars.scss';

  .tablehead__cell {
    color:$color__text--light;
    white-space: nowrap;
    vertical-align: top;
    padding:20px 15px;

    &:hover {
      color:$color__text;
    }
  }

  .tablehead__arrow {
    transition: all .2s linear;
    transform:rotate(0deg);
    opacity:0;
    display: inline-block;
    margin-left:10px;

    .icon {
      display:block;
    }
  }

  .tablehead__spacer {
    width:1px;
    padding-left:25px;
    padding-right:25px;
  }

  .tablehead__cell--draggable {
    padding:0;
  }

  .tablehead__cell--draggable,
  .tablehead__cell--bulk {
    width:1px;

    .tablehead__arrow {
      display:none;
    }
  }

  .tablehead__cell--bulk {
    padding-left:10px;
    padding-right:10px;

    a,
    .checkbox {
      display:block;
      width: 15px;
    }
  }

  .tablehead__cell--sortable {
    cursor:pointer;

    &:hover .tablehead__arrow {
      opacity:1;
    }

    &.tablehead__cell--sorted .tablehead__arrow {
      opacity:1;
    }
  }

  .tablehead__cell--sorteddesc .tablehead__arrow {
    transform:rotate(180deg);
  }
</style>
